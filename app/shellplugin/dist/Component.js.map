{"version":3,"file":"Component.js","names":["Component","BaseComponent","extend","metadata","manifest","interfaces","init","async","_init","BaseComponent.prototype.init.call","this","_paq","window","push","document","title","URL","url","sap","ui","require","toUrl","d","g","createElement","s","getElementsByTagName","type","defer","src","piwikid","fetchWorkzoneID","console","log","warn","parentNode","insertBefore","currentUrl","location","href","addEventListener","getHash","piwik_log","_getHash","newHash","hash","indexOf","substr","_fetchWorkzoneID","oModel","getModel","oBinding","bindContext","undefined","execute","oContext","getBoundContext","data","getObject","value","error"],"sources":["Component.ts"],"sourcesContent":["import BaseComponent from \"sap/ui/core/UIComponent\";\n\n/**\n * @namespace be.nmbs.shellplugin\n */\nexport default class Component extends BaseComponent {\n\n\tpublic static metadata = {\n\t\tmanifest: \"json\",\n        interfaces: [\n            \"sap.ui.core.IAsyncContentCreation\"\n        ]\n\t};\n\n\t\tpublic async init() : Promise<void> {\n\t\t// call the base component's init function\n\t\tsuper.init();\n\n        // call the base component's init function\n    super.init();\n    //@ts-ignore\n\n    \n    var _paq = window._paq = window._paq || [];\n    _paq.push([\"setDomains\", [\"*.hana.ondemand.com\"]]);\n    _paq.push(['enableLinkTracking']);\n    _paq.push(['setDocumentTitle', document.title]);\n    _paq.push(['setCustomUrl', document.URL]);\n    _paq.push(['trackPageView']);\n    \n    const url = sap.ui.require.toUrl(\"be/nmbs/plugins/wzanalyticsplugin\") + \"/Piwik/\";\n\n    _paq.push(['setTrackerUrl', url + 'piwik.php']);\n    _paq.push(['setSiteId', '35']);\n    var d = document, g = d.createElement('script'), s = d.getElementsByTagName('script')[0];\n    g.type = 'text/javascript';\n    g.async=true;\n    g.defer=true;\n\n\n    g.src = url + \"piwik.js\";\n    \n\n    //fetch de workzone id from cap\n    const piwikid = await this.fetchWorkzoneID();\n\n    console.log(piwikid);\n    console.warn(\"door de funtie\")\n\n    //@ts-ignore\n    s.parentNode.insertBefore(g, s);\n    var currentUrl = location.href;\n    window.addEventListener(\"hashchange\", () => {\n      _paq.push(['setReferrerUrl', currentUrl]);\n      currentUrl = document.URL;\n      _paq.push(['setCustomUrl', document.URL]);\n      _paq.push(['setDocumentTitle', this.getHash()]);\n      _paq.push(['trackPageView']);\n\n      // var content = document.getElementById('content');\n      _paq.push(['MediaAnalytics::scanForMedia', document]);\n      _paq.push(['FormAnalytics::scanForForms', document]);\n      _paq.push(['trackContentImpressionsWithinNode', document]);\n      _paq.push(['enableLinkTracking']);\n      //@ts-ignore\n      piwik_log(this.getHash(), piwikid[0], url + 'piwik.php');\n  \n    }, false);\n  }\n  /**\n   * getHash\n   */\n  public getHash() {\n    let newHash = location.hash;\n    if (newHash.indexOf(\"?\") > -1) {\n      newHash = location.hash.substr(0, location.hash.indexOf(\"?\"));\n    }\n    newHash = newHash.indexOf(\"&\") > -1 ? newHash.substr(0, newHash.indexOf(\"&\")) : newHash;\n    return newHash;\n  }\n\n  private async fetchWorkzoneID(): Promise<void> {\n    try {\n        const oModel = this.getModel() as any; \n        const oBinding = oModel?.bindContext(`/getWorkzoneID(...)`, undefined, {});\n        await oBinding?.execute();\n\n        const oContext = oBinding?.getBoundContext();\n        if (!oContext) {\n        console.warn(\"No context returned from getWorkzoneID\");\n        return;\n        }\n        const data = oContext.getObject();\n        if (data && data.value) {\n        console.log(\"Workzone ID:\", data.value);\n        return data.value\n        // use data.value here as needed\n        } else {\n        console.warn(\"No data.value found in context\");\n        }\n    } catch (error) {\n        console.error(\"Error fetching Workzone ID\", error);\n    }\n    }\n}"],"mappings":"mEAEA,MAGqBA,EAAkBC,EAAaC,OAAA,iCAErCC,SAAW,CACxBC,SAAU,OACJC,WAAY,CACR,sCAIGC,KAAIC,eAAAC,IAEjBC,sBAAAC,MAGED,sBAAAC,MAIA,IAAIC,EAAOC,OAAOD,KAAOC,OAAOD,MAAQ,GACxCA,EAAKE,KAAK,CAAC,aAAc,CAAC,yBAC1BF,EAAKE,KAAK,CAAC,uBACXF,EAAKE,KAAK,CAAC,mBAAoBC,SAASC,QACxCJ,EAAKE,KAAK,CAAC,eAAgBC,SAASE,MACpCL,EAAKE,KAAK,CAAC,kBAEX,MAAMI,EAAMC,IAAIC,GAAGC,QAAQC,MAAM,qCAAuC,UAExEV,EAAKE,KAAK,CAAC,gBAAiBI,EAAM,cAClCN,EAAKE,KAAK,CAAC,YAAa,OACxB,IAAIS,EAAIR,SAAUS,EAAID,EAAEE,cAAc,UAAWC,EAAIH,EAAEI,qBAAqB,UAAU,GACtFH,EAAEI,KAAO,kBACTJ,EAAEhB,MAAM,KACRgB,EAAEK,MAAM,KAGRL,EAAEM,IAAMZ,EAAM,WAId,MAAMa,QAAgBpB,KAAKqB,kBAE3BC,QAAQC,IAAIH,GACZE,QAAQE,KAAK,kBAGbT,EAAEU,WAAWC,aAAab,EAAGE,GAC7B,IAAIY,EAAaC,SAASC,KAC1B3B,OAAO4B,iBAAiB,aAAc,KACpC7B,EAAKE,KAAK,CAAC,iBAAkBwB,IAC7BA,EAAavB,SAASE,IACtBL,EAAKE,KAAK,CAAC,eAAgBC,SAASE,MACpCL,EAAKE,KAAK,CAAC,mBAAoBH,KAAK+B,YACpC9B,EAAKE,KAAK,CAAC,kBAGXF,EAAKE,KAAK,CAAC,+BAAgCC,WAC3CH,EAAKE,KAAK,CAAC,8BAA+BC,WAC1CH,EAAKE,KAAK,CAAC,oCAAqCC,WAChDH,EAAKE,KAAK,CAAC,uBAEX6B,UAAUhC,KAAK+B,UAAWX,EAAQ,GAAIb,EAAM,cAE3C,MACL,EAIOwB,QAAO,SAAAE,IACZ,IAAIC,EAAUN,SAASO,KACvB,GAAID,EAAQE,QAAQ,MAAQ,EAAG,CAC7BF,EAAUN,SAASO,KAAKE,OAAO,EAAGT,SAASO,KAAKC,QAAQ,KAC1D,CACAF,EAAUA,EAAQE,QAAQ,MAAQ,EAAIF,EAAQG,OAAO,EAAGH,EAAQE,QAAQ,MAAQF,EAChF,OAAOA,CACT,EAEcb,gBAAexB,eAAAyC,IAC3B,IACI,MAAMC,EAASvC,KAAKwC,WACpB,MAAMC,EAAWF,GAAQG,YAAY,sBAAuBC,UAAW,CAAC,SAClEF,GAAUG,WAEhB,MAAMC,EAAWJ,GAAUK,kBAC3B,IAAKD,EAAU,CACfvB,QAAQE,KAAK,0CACb,MACA,CACA,MAAMuB,EAAOF,EAASG,YACtB,GAAID,GAAQA,EAAKE,MAAO,CACxB3B,QAAQC,IAAI,eAAgBwB,EAAKE,OACjC,OAAOF,EAAKE,KAEZ,KAAO,CACP3B,QAAQE,KAAK,iCACb,CACJ,CAAE,MAAO0B,GACL5B,QAAQ4B,MAAM,6BAA8BA,EAChD,CACA,IAAC,OAlGgB5D,CAAS","ignoreList":[]}