{"version":3,"file":"Component-preload.js","sections":[{"offset":{"line":1,"column":0},"map":{"version":3,"names":["Component","BaseComponent","extend","metadata","manifest","interfaces","init","async","_init","BaseComponent.prototype.init.call","this","_paq","window","push","document","title","URL","piwikid","fetchWorkzoneID","url","sap","ui","require","toUrl","d","g","createElement","s","getElementsByTagName","type","defer","src","console","log","parentNode","insertBefore","currentUrl","location","href","addEventListener","getHash","piwik_log","_getHash","newHash","hash","indexOf","substr","_fetchWorkzoneID","oModel","getModel","oBinding","bindContext","undefined","execute","oContext","getBoundContext","warn","data","getObject","value","error"],"sources":["Component.ts"],"sourcesContent":["import BaseComponent from \"sap/ui/core/UIComponent\";\n\n/**\n * @namespace be.nmbs.shellplugin\n */\nexport default class Component extends BaseComponent {\n\n\tpublic static metadata = {\n\t\tmanifest: \"json\",\n        interfaces: [\n            \"sap.ui.core.IAsyncContentCreation\"\n        ]\n\t};\n\n\t\tpublic async init() : Promise<void> {\n\t\t// call the base component's init function\n\t\tsuper.init();\n\n        // call the base component's init function\n    super.init();\n    //@ts-ignore\n\n    \n    \n    var _paq = window._paq = window._paq || [];\n    _paq.push([\"setDomains\", [\"*.hana.ondemand.com\"]]);\n    _paq.push(['enableLinkTracking']);\n    _paq.push(['setDocumentTitle', document.title]);\n    _paq.push(['setCustomUrl', document.URL]);\n    _paq.push(['trackPageView']);\n    \n      //fetch de workzone id from cap\n    const piwikid = await this.fetchWorkzoneID();\n\n    const url = sap.ui.require.toUrl(\"be/nmbs/plugins/shellplugin\") + \"/Piwik/\";\n\n    _paq.push(['setTrackerUrl', url + 'piwik.php']);\n    _paq.push(['setSiteId', piwikid]);\n    var d = document, g = d.createElement('script'), s = d.getElementsByTagName('script')[0];\n    g.type = 'text/javascript';\n    g.async=true;\n    g.defer=true;\n\n\n    g.src = url + \"piwik.js\";\n    \n\n    \n\n    console.log(piwikid);\n\n    //@ts-ignore\n    s.parentNode.insertBefore(g, s);\n    var currentUrl = location.href;\n    window.addEventListener(\"hashchange\", () => {\n      _paq.push(['setReferrerUrl', currentUrl]);\n      currentUrl = document.URL;\n      _paq.push(['setCustomUrl', document.URL]);\n      _paq.push(['setDocumentTitle', this.getHash()]);\n      _paq.push(['trackPageView']);\n\n      // var content = document.getElementById('content');\n      _paq.push(['MediaAnalytics::scanForMedia', document]);\n      _paq.push(['FormAnalytics::scanForForms', document]);\n      _paq.push(['trackContentImpressionsWithinNode', document]);\n      _paq.push(['enableLinkTracking']);\n      //@ts-ignore\n      piwik_log(this.getHash(), piwikid, url + 'piwik.php');\n  \n    }, false);\n  }\n  /**\n   * getHash\n   */\n  public getHash() {\n    let newHash = location.hash;\n    if (newHash.indexOf(\"?\") > -1) {\n      newHash = location.hash.substr(0, location.hash.indexOf(\"?\"));\n    }\n    newHash = newHash.indexOf(\"&\") > -1 ? newHash.substr(0, newHash.indexOf(\"&\")) : newHash;\n    return newHash;\n  }\n\n  private async fetchWorkzoneID(): Promise<string> {\n    try {\n        const oModel = this.getModel() as any; \n        const oBinding = oModel?.bindContext(`/getWorkzoneID(...)`, undefined, {});\n        await oBinding?.execute();\n\n        const oContext = oBinding?.getBoundContext();\n        if (!oContext) {\n        console.warn(\"No context returned from getWorkzoneID\");\n        return \"\";\n        }\n        const data = oContext.getObject();\n        if (data && data.value) {\n        console.log(\"Workzone ID:\", data.value);\n        return data.value\n        // use data.value here as needed\n        } else {\n        console.warn(\"No data.value found in context\");\n        return \"\";\n        }\n    } catch (error) {\n        console.error(\"Error fetching Workzone ID\", error);\n        return \"\";\n    }\n    }\n}"],"mappings":"AAAA,uGAEA,MAGqBA,EAAkBC,EAAaC,OAAA,iCAErCC,SAAW,CACxBC,SAAU,OACJC,WAAY,CACR,sCAIGC,KAAIC,eAAAC,IAEjBC,sBAAAC,MAGED,sBAAAC,MAKA,IAAIC,EAAOC,OAAOD,KAAOC,OAAOD,MAAQ,GACxCA,EAAKE,KAAK,CAAC,aAAc,CAAC,yBAC1BF,EAAKE,KAAK,CAAC,uBACXF,EAAKE,KAAK,CAAC,mBAAoBC,SAASC,QACxCJ,EAAKE,KAAK,CAAC,eAAgBC,SAASE,MACpCL,EAAKE,KAAK,CAAC,kBAGX,MAAMI,QAAgBP,KAAKQ,kBAE3B,MAAMC,EAAMC,IAAIC,GAAGC,QAAQC,MAAM,+BAAiC,UAElEZ,EAAKE,KAAK,CAAC,gBAAiBM,EAAM,cAClCR,EAAKE,KAAK,CAAC,YAAaI,IACxB,IAAIO,EAAIV,SAAUW,EAAID,EAAEE,cAAc,UAAWC,EAAIH,EAAEI,qBAAqB,UAAU,GACtFH,EAAEI,KAAO,kBACTJ,EAAElB,MAAM,KACRkB,EAAEK,MAAM,KAGRL,EAAEM,IAAMZ,EAAM,WAKda,QAAQC,IAAIhB,GAGZU,EAAEO,WAAWC,aAAaV,EAAGE,GAC7B,IAAIS,EAAaC,SAASC,KAC1B1B,OAAO2B,iBAAiB,aAAc,KACpC5B,EAAKE,KAAK,CAAC,iBAAkBuB,IAC7BA,EAAatB,SAASE,IACtBL,EAAKE,KAAK,CAAC,eAAgBC,SAASE,MACpCL,EAAKE,KAAK,CAAC,mBAAoBH,KAAK8B,YACpC7B,EAAKE,KAAK,CAAC,kBAGXF,EAAKE,KAAK,CAAC,+BAAgCC,WAC3CH,EAAKE,KAAK,CAAC,8BAA+BC,WAC1CH,EAAKE,KAAK,CAAC,oCAAqCC,WAChDH,EAAKE,KAAK,CAAC,uBAEX4B,UAAU/B,KAAK8B,UAAWvB,EAASE,EAAM,cAExC,MACL,EAIOqB,QAAO,SAAAE,IACZ,IAAIC,EAAUN,SAASO,KACvB,GAAID,EAAQE,QAAQ,MAAQ,EAAG,CAC7BF,EAAUN,SAASO,KAAKE,OAAO,EAAGT,SAASO,KAAKC,QAAQ,KAC1D,CACAF,EAAUA,EAAQE,QAAQ,MAAQ,EAAIF,EAAQG,OAAO,EAAGH,EAAQE,QAAQ,MAAQF,EAChF,OAAOA,CACT,EAEczB,gBAAeX,eAAAwC,IAC3B,IACI,MAAMC,EAAStC,KAAKuC,WACpB,MAAMC,EAAWF,GAAQG,YAAY,sBAAuBC,UAAW,CAAC,SAClEF,GAAUG,WAEhB,MAAMC,EAAWJ,GAAUK,kBAC3B,IAAKD,EAAU,CACftB,QAAQwB,KAAK,0CACb,MAAO,EACP,CACA,MAAMC,EAAOH,EAASI,YACtB,GAAID,GAAQA,EAAKE,MAAO,CACxB3B,QAAQC,IAAI,eAAgBwB,EAAKE,OACjC,OAAOF,EAAKE,KAEZ,KAAO,CACP3B,QAAQwB,KAAK,kCACb,MAAO,EACP,CACJ,CAAE,MAAOI,GACL5B,QAAQ4B,MAAM,6BAA8BA,GAC5C,MAAO,EACX,CACA,IAAC,OAtGgB5D,CAAS","ignoreList":[],"sourceRoot":""}},{"offset":{"line":2,"column":0},"map":{"version":3,"names":[],"sources":["Component-preload.js?bundle-code-0"],"mappings":"AAAA;AACA","sourcesContent":["sap.ui.require.preload({\n"],"sourceRoot":""}}]}