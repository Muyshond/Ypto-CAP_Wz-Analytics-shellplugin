{"version":3,"file":"Component-dbg.js","names":["Component","BaseComponent","extend","metadata","manifest","interfaces","init","_init","BaseComponent.prototype.init.call","_paq","window","push","document","title","URL","piwikid","fetchWorkzoneID","url","sap","ui","require","toUrl","d","g","createElement","s","getElementsByTagName","type","async","defer","src","console","log","parentNode","insertBefore","currentUrl","location","href","addEventListener","getHash","piwik_log","_getHash","newHash","hash","indexOf","substr","_fetchWorkzoneID","oModel","getModel","oBinding","bindContext","undefined","execute","oContext","getBoundContext","warn","data","getObject","value","error"],"sources":["Component.ts"],"sourcesContent":["import BaseComponent from \"sap/ui/core/UIComponent\";\n\n/**\n * @namespace be.nmbs.shellplugin\n */\nexport default class Component extends BaseComponent {\n\n\tpublic static metadata = {\n\t\tmanifest: \"json\",\n        interfaces: [\n            \"sap.ui.core.IAsyncContentCreation\"\n        ]\n\t};\n\n\t\tpublic async init() : Promise<void> {\n\t\t// call the base component's init function\n\t\tsuper.init();\n\n        // call the base component's init function\n    super.init();\n    //@ts-ignore\n\n    \n    \n    var _paq = window._paq = window._paq || [];\n    _paq.push([\"setDomains\", [\"*.hana.ondemand.com\"]]);\n    _paq.push(['enableLinkTracking']);\n    _paq.push(['setDocumentTitle', document.title]);\n    _paq.push(['setCustomUrl', document.URL]);\n    _paq.push(['trackPageView']);\n    \n      //fetch de workzone id from cap\n    const piwikid = await this.fetchWorkzoneID();\n\n    const url = sap.ui.require.toUrl(\"be/nmbs/shellplugin\") + \"/Piwik/\";\n\n    _paq.push(['setTrackerUrl', url + 'piwik.php']);\n    _paq.push(['setSiteId', piwikid]);\n    var d = document, g = d.createElement('script'), s = d.getElementsByTagName('script')[0];\n    g.type = 'text/javascript';\n    g.async=true;\n    g.defer=true;\n\n\n    g.src = url + \"piwik.js\";\n    \n\n    \n\n    console.log(piwikid);\n\n    //@ts-ignore\n    s.parentNode.insertBefore(g, s);\n    var currentUrl = location.href;\n    window.addEventListener(\"hashchange\", () => {\n      _paq.push(['setReferrerUrl', currentUrl]);\n      currentUrl = document.URL;\n      _paq.push(['setCustomUrl', document.URL]);\n      _paq.push(['setDocumentTitle', this.getHash()]);\n      _paq.push(['trackPageView']);\n\n      // var content = document.getElementById('content');\n      _paq.push(['MediaAnalytics::scanForMedia', document]);\n      _paq.push(['FormAnalytics::scanForForms', document]);\n      _paq.push(['trackContentImpressionsWithinNode', document]);\n      _paq.push(['enableLinkTracking']);\n      //@ts-ignore\n      piwik_log(this.getHash(), piwikid, url + 'piwik.php');\n  \n    }, false);\n  }\n  /**\n   * getHash\n   */\n  public getHash() {\n    let newHash = location.hash;\n    if (newHash.indexOf(\"?\") > -1) {\n      newHash = location.hash.substr(0, location.hash.indexOf(\"?\"));\n    }\n    newHash = newHash.indexOf(\"&\") > -1 ? newHash.substr(0, newHash.indexOf(\"&\")) : newHash;\n    return newHash;\n  }\n\n  private async fetchWorkzoneID(): Promise<string> {\n    try {\n        const oModel = this.getModel() as any; \n        const oBinding = oModel?.bindContext(`/getWorkzoneID(...)`, undefined, {});\n        await oBinding?.execute();\n\n        const oContext = oBinding?.getBoundContext();\n        if (!oContext) {\n        console.warn(\"No context returned from getWorkzoneID\");\n        return \"\";\n        }\n        const data = oContext.getObject();\n        if (data && data.value) {\n        console.log(\"Workzone ID:\", data.value);\n        return data.value\n        // use data.value here as needed\n        } else {\n        console.warn(\"No data.value found in context\");\n        return \"\";\n        }\n    } catch (error) {\n        console.error(\"Error fetching Workzone ID\", error);\n        return \"\";\n    }\n    }\n}"],"mappings":"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","ignoreList":[]}